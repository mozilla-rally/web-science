<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Module: timing</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Module: timing</h1>

    




<section>

<header>
    
        
            
        
    
</header>

<article>
    <div class="container-overview">
    
        
            <div class="description"><p>This module facilitates timestamping events, using a standardized clock.
When supported by the browser, WebScience uses the shared monotonic clock
specified by the W3C High Resolution Time recommendation. Otherwise,
WebScience uses the system clock.</p>
<h2>Web Browser Clocks</h2>
<p>There are two clocks supported in modern web browsers.</p>
<ul>
<li><strong>System Clock</strong> (<code>Date.now()</code> or <code>new Date</code>). The system clock is
the ordinary time provided by the operating system. Using the
system clock to timestamp events poses a risk: the user or operating
system can adjust the clock at any time, for any reason, without any
notice, to any value. The user might manually adjust the clock, for
example, or the operating system might synchronize the clock to account
for clock skew (e.g., NTP time sync). These adjustments can be large and
non-monotonic, breaking assumptions that WebScience makes about timestamp
proximity and ordering. A clock change during study execution could
introduce subtle bugs or other unexpected behavior.</li>
<li><strong>Shared Monotonic Clock</strong>
(<code>performance.timeOrigin + performance.now()</code>). The W3C High Resolution
Time recommendation specifies a shared monotonic clock. This clock
should have the following properties:
<ul>
<li>strictly monotonic;</li>
<li>not subject to large or non-monotonic adjustments from any source;</li>
<li>consistent across cores, processes, threads, and globals down to the
hardware level; and</li>
<li>synchronized to the system clock just once, on browser startup.</li>
</ul>
</li>
</ul>
<p>Our goal is to migrate WebScience and Rally studies to the shared monotonic
clock, because it does not have clock change risks like the system clock.
Unfortunately, browser implementations of High Resolution Time currently
depart from the W3C recommendation in significant ways that prevent reliance
on the shared monotonic clock. We will update this module as browsers correct
their implementations.</p>
<h2>Additional Notes</h2>
<ul>
<li>The High Resolution Time spec describes a shared monotonic clock (which
must be used to generate <code>performance.timeOrigin</code> for each global) and
per-global monotonic clocks (which tick for  <code>performance.now()</code> and other
uses of <code>DOMHighResTimeStamp</code>). Monotonic clocks on modern hardware are
synchronized across cores, processes, and threads, so we treat
<code>performance.timeOrigin + performance.now()</code> as the current time on the
shared monotonic clock, even though the W3C spec doesn't <em>quite</em> say that.</li>
<li>Firefox and Chrome currently depart from the High Resolution Time
spec in significant ways: <code>performance.timeOrigin</code> is sometimes set from
the system clock rather than the shared monotonic clock, and
<code>performance.now()</code> (and other uses of <code>DOMHighResTimeStamp</code>) do not
tick during system sleep on certain platforms.</li>
</ul></div>
        

        
            















<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="timing.js.html">timing.js</a>, <a href="timing.js.html#line1">line 1</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="https://www.w3.org/TR/hr-time-2/">https://www.w3.org/TR/hr-time-2/</a></li>
        
            <li><a href="https://github.com/mdn/content/issues/4713">https://github.com/mdn/content/issues/4713</a></li>
        
            <li><a href="https://github.com/w3c/hr-time/issues/65">https://github.com/w3c/hr-time/issues/65</a></li>
        </ul>
    </dd>
    

    
</dl>




















        
    
    </div>

    

    

    

    

    

    

    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    
    <h4 class="name" id=".fromMonotonicClock"><span class="type-signature">(static) </span>fromMonotonicClock<span class="signature">(timeStamp, relativeToTimeOrigin)</span><span class="type-signature"> &rarr; {number}</span></h4>
    

    



<div class="description">
    <p>Convert a timestamp on the shared monotonic clock to a timestamp
on the standardized clock. Use this function only where strictly
necessary, and where it can be used immediately after the timestamp
on the monotonic clock. There is a risk that the system clock will
have changed between the timestamp and now or that the monotonic
clock was affected by an implementation bug.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>timeStamp</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            

            

            <td class="description last"><p>A timestamp, in milliseconds since the
epoch, on the shared monotonic clock.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>relativeToTimeOrigin</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>


            
            </td>

            

            

            <td class="description last"><p>Whether the timestamp
is relative to a time origin (e.g., a DOM event or Performance API
timestamp), or the time origin has already been added to the
timestamp (e.g., <code>performance.timeOrigin</code> or
<code>performance.timeOrigin + performance.now()</code>).</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="timing.js.html">timing.js</a>, <a href="timing.js.html#line127">line 127</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>A timestamp, in milliseconds since the epoch, on
the standardized clock.</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">number</span>


    </dd>
</dl>

    




    <h5>Examples</h5>
    
    <pre class="prettyprint"><code>const monotonicTimeStamp = performance.timeOrigin;
const standardizedTimeStamp = webScience.timing.fromMonotonicClock(monotonicTimeStamp, false);</code></pre>

    <pre class="prettyprint"><code>const monotonicTimeStamp = performance.timeOrigin + performance.now();
const standardizedTimeStamp = webScience.timing.fromMonotonicClock(monotonicTimeStamp, false);</code></pre>

    <pre class="prettyprint"><code>const relativeMonotonicTimeStamp = performance.now();
const standardizedTimeStamp = webScience.timing.fromMonotonicClock(relativeMonotonicTimeStamp, true);</code></pre>



        
            

    

    
    <h4 class="name" id=".fromSystemClock"><span class="type-signature">(static) </span>fromSystemClock<span class="signature">(timeStamp)</span><span class="type-signature"> &rarr; {number}</span></h4>
    

    



<div class="description">
    <p>Convert a timestamp on the system clock to a timestamp on the
standardized clock. Use this function only where strictly necessary,
and where it can be used immediately after the timestamp on the
system clock. There is a risk that the system clock will have
changed between the timestamp and now.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>timeStamp</code></td>
            

            <td class="type">
            
                
<span class="param-type">number</span>


            
            </td>

            

            

            <td class="description last"><p>A timestamp, in milliseconds since the
epoch, on the system clock.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="timing.js.html">timing.js</a>, <a href="timing.js.html#line94">line 94</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>A timestamp, in milliseconds since the epoch, on
the standardized clock.</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">number</span>


    </dd>
</dl>

    




    <h5>Example</h5>
    
    <pre class="prettyprint"><code>const systemTimeStamp = Date.now();
const standardizedTimeStamp = webScience.timing.fromSystemClock(systemTimeStamp);</code></pre>



        
            

    

    
    <h4 class="name" id=".now"><span class="type-signature">(static) </span>now<span class="signature">()</span><span class="type-signature"> &rarr; {number}</span></h4>
    

    



<div class="description">
    <p>Get the current time, in milliseconds since the epoch, using a
standardized clock.</p>
</div>













<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="timing.js.html">timing.js</a>, <a href="timing.js.html#line73">line 73</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>The current time, in milliseconds since the epoch.</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">number</span>


    </dd>
</dl>

    





        
    

    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-debugging.html">debugging</a></li><li><a href="module-events.html">events</a></li><li><a href="module-id.html">id</a></li><li><a href="module-idle.html">idle</a></li><li><a href="module-inline.html">inline</a></li><li><a href="module-linkExposure.html">linkExposure</a></li><li><a href="module-linkResolution.html">linkResolution</a></li><li><a href="module-matching.html">matching</a></li><li><a href="module-messaging.html">messaging</a></li><li><a href="module-pageManager.html">pageManager</a></li><li><a href="module-pageNavigation.html">pageNavigation</a></li><li><a href="module-pageText.html">pageText</a></li><li><a href="module-pageTransition.html">pageTransition</a></li><li><a href="module-permissions.html">permissions</a></li><li><a href="module-randomization.html">randomization</a></li><li><a href="module-scheduling.html">scheduling</a></li><li><a href="module-socialMediaActivity.html">socialMediaActivity</a></li><li><a href="module-socialMediaLinkSharing.html">socialMediaLinkSharing</a></li><li><a href="module-storage.html">storage</a></li><li><a href="module-timing.html">timing</a></li><li><a href="module-userSurvey.html">userSurvey</a></li><li><a href="module-workers.html">workers</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-idle.onStateChanged.html">onStateChanged</a></li><li><a href="module-linkExposure.onLinkExposureData.html">onLinkExposureData</a></li><li><a href="module-linkExposure.onLinkExposureUpdate.html">onLinkExposureUpdate</a></li><li><a href="module-messaging.onMessage.html">onMessage</a></li><li><a href="module-pageManager.onPageVisitStart.html">onPageVisitStart</a></li><li><a href="module-pageManager.onPageVisitStop.html">onPageVisitStop</a></li><li><a href="module-pageNavigation.onPageData.html">onPageData</a></li><li><a href="module-pageText.onTextParsed.html">onTextParsed</a></li><li><a href="module-pageTransition.onPageTransitionData.html">onPageTransitionData</a></li><li><a href="module-scheduling.onIdleDaily.html">onIdleDaily</a></li><li><a href="module-scheduling.onIdleWeekly.html">onIdleWeekly</a></li></ul><h3>Classes</h3><ul><li><a href="module-events-Event.html">Event</a></li><li><a href="module-matching-MatchPatternSet.html">MatchPatternSet</a></li><li><a href="module-storage-Counter.html">Counter</a></li><li><a href="module-storage-KeyValueStorage.html">KeyValueStorage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Mon Aug 30 2021 01:39:31 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>