<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Module: pageTransition</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Module: pageTransition</h1>

    




<section>

<header>
    
        
            
        
    
</header>

<article>
    <div class="container-overview">
    
        
            <div class="description"><p>This module enables observing webpage transitions, synthesizing a range of
transition data that may be valuable for browser-based studies. See the
<code>onPageTransitionData</code> event for details.</p>
<h2>Types of Page Transition Data</h2>
<p>This module supports several types of page transition data. Some types are
supported and recommended, because the data is consistently available, has
consistent meaning, and reflects discrete categories of user interactions.
Other types of transition data are supported because they appear in prior
academic literature, but we  do not recommend them because of significant
limitations.</p>
<ul>
<li>Supported and Recommended Types of Page Transition Data
<ul>
<li>WebExtensions Transitions - This module reports the same webpage
transition data provided by the WebExtensions <code>webNavigation</code> API. There
are two types of transition data: <code>TransitionType</code> (e.g., &quot;link&quot; or
&quot;typed&quot;) and <code>TransitionQualifier</code> (e.g., &quot;from_address_bar&quot; or
&quot;forward_back&quot;). Note that Firefox's support for these values is mostly
but not entirely complete and defaults to a &quot;link&quot; transition type. The
MDN documentation for Firefox's implementation is also currently out of
date, see: https://github.com/mdn/browser-compat-data/issues/9019. We
recommend checking click transition data to confirm whether the user
clicked on a link.</li>
<li>Tab-based Transitions - This module reports the webpage that was
previously loaded in a new webpage's tab. If the webpage is loading in a
newly created tab, this module reports the webpage that was open in
the opener tab. We recommend using tab-based transition data when the user
has clicked a link (according to both WebExtensions and click data), when
the user has navigated with forward and back buttons, and when the page
has refreshed (due to user action or automatically). In these situations,
there is a clear causal relationship between the previous and current
pages. We do not otherwise recommend using tab-based transition data,
because the user might be reusing a tab for reasons unrelated to the page
loaded in the tab.</li>
<li>Click Transitions - This module reports when a click on a webpage is
immediately followed by a new webpage loading in the same tab (or a
newly opened tab were that tab is the opener). This activity indicates
the user likely clicked a link, and it compensates for limitations in
how browsers detect link clicks for the <code>webNavigation</code> API.</li>
</ul>
</li>
<li>Supported But Not Recommended Types of Page Transition Data
<ul>
<li>Referrers - This module reports the HTTP referrer for each new page. While
referrers have long been a method for associating webpage loads with
prior pages, they are not consistently available (webpages and browsers
are increasingly limiting when referrers are sent), do not have consistent
content (similarly, webpages and browsers are increasingly limiting
referrers to just origins), and do not have consistent meaning (the rules
for setting referrers are notoriously complex and can have nonintuitive
semantics). Be especially careful with referrers for webpage loads via
the History API---because there is no new document-level HTTP request, the
referrer will not change when the URL changes.</li>
<li>Time-based Transitions - This module reports the most recent webpage that
loaded in any tab. We do not recommend relying on this data, because a
chronological ordering of webpage loads may have no relation to user
activity or perception (e.g., a webpage might automatically reload in the
background before a user navigates to a new page).</li>
</ul>
</li>
</ul>
<h2>Page Transition Data Sources</h2>
<p>This module builds on the page tracking provided by the <code>pageManager</code>
module and uses browser events, DOM events, and a set of heuristics to
associate transition information with each page visit. The module relies on
the following sources of data about page transitions, in addition to the
page visit tracking, attention tracking, and URL normalization provided by
<code>pageManager</code>:</p>
<ul>
<li>Background Script Data Sources
<ul>
<li><code>webNavigation.onCommitted</code> - provides tab ID, url,
<code>webNavigation.TransitionType</code>, and <code>webNavigation.TransitionQualifier</code>
values when a new page is loading in a tab.</li>
<li><code>webNavigation.onDOMContentLoaded</code> - provides tab ID, url, and a
timestamp approximating when the <code>DOMContentLoaded</code> event fired on a
page.</li>
<li><code>webNavigation.onHistoryStateUpdated</code> - provides tab ID, url,
<code>webNavigation.TransitionType</code>, and <code>webNavigation.TransitionQualifier</code>
values when a new page loads in a tab via the History API.</li>
<li><code>webNavigation.onCreatedNavigationTarget</code> - provides tab ID, source
tab ID, and url when a page loads in a tab newly created by another
tab. Because of a regression, this event does not currently fire
in Firefox for a click on a link with the target=&quot;_blank&quot; attribute.</li>
<li><code>tabs.onCreated</code> - provides tab ID and source tab ID when a page
loads in a tab newly created by another tab, except if the new
tab is in a different window.</li>
</ul>
</li>
<li>Content Script Data Sources
<ul>
<li>The <code>click</code> event on the <code>document</code> element - detects possible link
clicks via the mouse (e.g., left click).</li>
<li>The <code>contextmenu</code> event on the <code>document</code> element - detects possible
link clicks via the mouse (e.g., right click or control + click).</li>
<li>The <code>keyup</code> event on the document element - detects possible link
clicks via the keyboard.</li>
</ul>
</li>
</ul>
<h2>Combining Data Sources into a Page Transition</h2>
<p>Merging these data sources into a page transition event poses several
challenges.</p>
<ul>
<li>We have to sync background script <code>webNavigation</code> events with content
scripts. As with <code>pageManager</code>, we have to account for the possibility
of race conditions between the background script and content script
environments. We use the same general approach in this module as in
<code>pageManager</code>, converting background script events into messages posted
to content scripts. We have to be a bit more careful about race
conditions than in <code>pageManager</code>, though, because if a tab property
event handled in that module goes to the wrong content script the
consequences are minimal (because correct event data will quickly
arrive afterward). In this module, by contrast, an error could mean
incorrectly associating a pair of pages. We further account for the
possibility of race conditions by matching the <code>webNavigation</code> URL and
DOMContentLoaded timestamp with the content script's URL and
DOMContentLoaded timestamp.</li>
<li>We have to sync background script <code>webNavigation</code> events for different
stages in the webpage loading lifecycle, because we want properties of
both <code>webNavigation.onCommitted</code> and <code>webNavigation.onDOMContentLoaded</code>:
the former has transition types and qualifiers, while the latter has a
timestamp that is comparable to an event in the content script and does
not have the risk of firing before the content script is ready to
receive messages. Unlike <code>webRequest</code> events, <code>webNavigation</code> events are
not associated with unique identifiers. We accomplish syncing across
events by assuming that when the <code>webNavigation.onDOMContentLoaded</code> event
fires for a tab, it is part of the same navigation lifecycle as the most
recent <code>webNavigation.onCommitted</code> event in the tab.</li>
<li>We have to sync content script data for a page with content script
data for a prior page (either loaded in the same tab, loaded in an
opener tab, or loaded immediately before in time). We accomplish this for
ordinary page loads by maintaining a cache of page visit data in the
in the background script. We accomplish this for History API page loads
by passing information in the content script environment.</li>
<li>We have to account for a regression in Firefox where
<code>webNavigation.onCreatedNavigationTarget</code> does not currently fire for
a click on a link with the target=&quot;_blank&quot; attribute. We accomplish this
by using <code>tabs.onCreated</code> event data when
<code>webNavigation.onCreatedNavigationTarget</code> event data is not available.</li>
</ul></div>
        

        
            















<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="pageTransition.js.html">pageTransition.js</a>, <a href="pageTransition.js.html#line1">line 1</a>
    </li></ul></dd>
    

    

    
    <dt class="tag-see">See:</dt>
    <dd class="tag-see">
        <ul>
            <li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webNavigation/onCommitted">https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webNavigation/onCommitted</a></li>
        
            <li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webNavigation/TransitionType">https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webNavigation/TransitionType</a></li>
        
            <li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webNavigation/TransitionQualifier">https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webNavigation/TransitionQualifier</a></li>
        
            <li><a href="https://github.com/mdn/browser-compat-data/issues/9019">https://github.com/mdn/browser-compat-data/issues/9019</a></li>
        
            <li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/onCreated">https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/onCreated</a></li>
        </ul>
    </dd>
    

    
</dl>




















        
    
    </div>

    

    

    

    

    

    
        <h3 class="subsection-title">Namespaces</h3>

        <dl>
            <dt><a href="module-pageTransition.onPageTransitionData.html">onPageTransitionData</a></dt>
            <dd></dd>
        </dl>
    

    

    

    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-debugging.html">debugging</a></li><li><a href="module-events.html">events</a></li><li><a href="module-id.html">id</a></li><li><a href="module-idle.html">idle</a></li><li><a href="module-inline.html">inline</a></li><li><a href="module-linkExposure.html">linkExposure</a></li><li><a href="module-linkResolution.html">linkResolution</a></li><li><a href="module-matching.html">matching</a></li><li><a href="module-messaging.html">messaging</a></li><li><a href="module-pageManager.html">pageManager</a></li><li><a href="module-pageNavigation.html">pageNavigation</a></li><li><a href="module-pageText.html">pageText</a></li><li><a href="module-pageTransition.html">pageTransition</a></li><li><a href="module-permissions.html">permissions</a></li><li><a href="module-randomization.html">randomization</a></li><li><a href="module-scheduling.html">scheduling</a></li><li><a href="module-socialMediaActivity.html">socialMediaActivity</a></li><li><a href="module-socialMediaLinkSharing.html">socialMediaLinkSharing</a></li><li><a href="module-storage.html">storage</a></li><li><a href="module-timing.html">timing</a></li><li><a href="module-userSurvey.html">userSurvey</a></li><li><a href="module-workers.html">workers</a></li></ul><h3>Namespaces</h3><ul><li><a href="module-idle.onStateChanged.html">onStateChanged</a></li><li><a href="module-linkExposure.onLinkExposureData.html">onLinkExposureData</a></li><li><a href="module-linkExposure.onLinkExposureUpdate.html">onLinkExposureUpdate</a></li><li><a href="module-messaging.onMessage.html">onMessage</a></li><li><a href="module-pageManager.onPageVisitStart.html">onPageVisitStart</a></li><li><a href="module-pageManager.onPageVisitStop.html">onPageVisitStop</a></li><li><a href="module-pageNavigation.onPageData.html">onPageData</a></li><li><a href="module-pageText.onTextParsed.html">onTextParsed</a></li><li><a href="module-pageTransition.onPageTransitionData.html">onPageTransitionData</a></li><li><a href="module-scheduling.onIdleDaily.html">onIdleDaily</a></li><li><a href="module-scheduling.onIdleWeekly.html">onIdleWeekly</a></li></ul><h3>Classes</h3><ul><li><a href="module-events-Event.html">Event</a></li><li><a href="module-matching-MatchPatternSet.html">MatchPatternSet</a></li><li><a href="module-storage-Counter.html">Counter</a></li><li><a href="module-storage-KeyValueStorage.html">KeyValueStorage</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Tue Nov 30 2021 20:38:00 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>